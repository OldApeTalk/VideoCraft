# 视频水印功能说明

## ✨ 功能概述

为生成的视频添加可自定义的文字水印，支持：
- 自定义水印文字
- 多种颜色选择
- 中英文字体支持
- 透明度调节
- 四角位置选择
- **自适应分辨率** - 无论什么分辨率，水印视觉大小保持一致

## 🎨 水印配置选项

### 1. 水印文字
- **默认值**："老猿世界观察"
- **可自定义**：支持中英文、数字、特殊符号
- **建议长度**：4-10个字符（过长会影响观看）

### 2. 文字颜色
| 颜色 | 适用场景 | 推荐度 |
|------|---------|--------|
| **白色 (white)** | 深色背景 | ⭐⭐⭐⭐⭐ |
| 黑色 (black) | 浅色背景 | ⭐⭐⭐⭐ |
| 红色 (red) | 强调、警告 | ⭐⭐⭐ |
| 黄色 (yellow) | 深色背景 | ⭐⭐⭐ |
| 蓝色 (blue) | 浅色背景 | ⭐⭐⭐ |
| 绿色 (green) | 特殊主题 | ⭐⭐ |

### 3. 字体选择
| 字体 | 特点 | 推荐用途 |
|------|------|---------|
| **arial.ttf** | 英文默认 | 英文水印 |
| **simhei.ttf (黑体)** | 粗壮清晰 | 中文推荐 ⭐⭐⭐⭐⭐ |
| simsun.ttc (宋体) | 经典正式 | 正式内容 |
| msyh.ttc (微软雅黑) | 现代简洁 | 通用中文 ⭐⭐⭐⭐ |
| simkai.ttf (楷体) | 手写风格 | 艺术内容 |

**注意**：使用中文字体需要 Windows 系统字体支持

### 4. 透明度
- **范围**：0.1 ~ 1.0
- **推荐值**：0.5（半透明）
- **说明**：
  - 0.1 - 几乎透明，非常淡
  - 0.5 - 半透明，既可见又不碍眼 ⭐ 推荐
  - 1.0 - 完全不透明

### 5. 位置选择
```
┌─────────────────────────┐
│ 左上角      右上角 ⭐   │  推荐右上角：
│                          │  - 不遮挡主要内容
│                          │  - 符合观看习惯
│                          │  - 平台常见位置
│ 左下角      右下角       │
└─────────────────────────┘
```

## 🔧 自适应算法

### 字体大小计算
```python
基准分辨率: 1080p (高度 1080px)
基准字体大小: 36px

字体大小 = 36 × (当前高度 / 1080)
```

### 实际示例

| 分辨率 | 高度 | 字体大小 | 边距 |
|--------|------|---------|------|
| 720p (1280x720) | 720 | 24px | 13px |
| **1080p (1920x1080)** | 1080 | **36px** | **20px** |
| 2K (2560x1440) | 1440 | 48px | 27px |
| 4K (3840x2160) | 2160 | 72px | 40px |
| 竖屏720p (720x1280) | 1280 | 43px | 24px |
| **竖屏1080p (1080x1920)** | 1920 | **64px** | **36px** |
| 竖屏4K (2160x3840) | 3840 | 128px | 71px |

**结论**：无论什么分辨率，水印在画面中的**视觉大小比例**保持一致！

## 📝 使用步骤

### 1. 启用水印
✅ 勾选"启用水印"复选框

### 2. 配置水印
- **修改文字**：在"水印文字"输入框中输入内容
- **选择颜色**：根据背景色选择合适的颜色
- **选择字体**：中文内容选择黑体或微软雅黑
- **调整透明度**：拖动滑块到 0.5 左右
- **选择位置**：推荐右上角

### 3. 生成视频
点击"生成视频"按钮，水印会自动叠加到视频上

## 🎯 最佳实践

### 推荐配置

**短视频配置（抖音/快手）：**
```
水印文字: 老猿世界观察
文字颜色: white (白色)
字体: simhei.ttf (黑体)
透明度: 0.5
位置: 右上角
```

**长视频配置（YouTube/B站）：**
```
水印文字: 老猿世界观察
文字颜色: white (白色)
字体: msyh.ttc (微软雅黑)
透明度: 0.4
位置: 右上角
```

### 颜色搭配建议

| 背景类型 | 推荐颜色 | 透明度 |
|---------|---------|--------|
| 深色/黑色背景 | white (白色) | 0.5-0.7 |
| 浅色/白色背景 | black (黑色) | 0.5-0.7 |
| 彩色背景 | white (白色) | 0.6-0.8 |
| 复杂图片 | white (白色) + 黑色描边 | 0.5 |

### 字体选择建议

**纯中文：**
- 首选：simhei.ttf (黑体)
- 备选：msyh.ttc (微软雅黑)

**纯英文/数字：**
- 首选：arial.ttf

**中英混合：**
- 首选：msyh.ttc (微软雅黑)
- 备选：simhei.ttf (黑体)

## ⚠️ 注意事项

### 1. 字体文件要求
- 中文字体需要 Windows 系统
- 路径：`C:\Windows\Fonts\`
- 如果字体不存在会导致生成失败

### 2. 特殊字符处理
- 避免使用 `:` 等 FFmpeg 特殊字符
- 程序会自动转义部分特殊字符
- 建议使用简单文字

### 3. 性能影响
- 添加水印会略微增加处理时间（<5%）
- 对视频文件大小影响很小

### 4. 预览建议
- 首次使用建议先用短音频测试
- 查看水印位置、大小是否合适
- 根据需要调整透明度和颜色

## 🐛 常见问题

### Q1: 水印不显示？
**可能原因**：
1. 未勾选"启用水印"
2. 水印文字为空
3. 字体文件不存在

**解决方案**：
- 检查是否勾选启用
- 确认水印文字已输入
- 使用默认字体 arial.ttf

### Q2: 中文水印显示乱码？
**原因**：使用了英文字体

**解决方案**：选择中文字体（黑体、微软雅黑等）

### Q3: 水印太大或太小？
**说明**：这是自适应算法的正常表现

**调整方式**：
- 水印大小由分辨率自动决定
- 如需调整，可以修改分辨率
- 视觉大小比例是固定的

### Q4: 水印遮挡内容？
**解决方案**：
- 更换水印位置（四角任选）
- 降低透明度（如 0.3）
- 缩短水印文字

### Q5: 生成失败提示 ffmpeg 错误？
**可能原因**：
- 字体路径错误
- 特殊字符未转义
- FFmpeg 版本过旧

**解决方案**：
- 使用系统默认字体
- 简化水印文字
- 更新 FFmpeg 到最新版本

## 🔍 技术细节

### FFmpeg drawtext 滤镜

完整的 drawtext 参数：
```bash
drawtext=text='水印文字':
         fontfile=C\:/Windows/Fonts/simhei.ttf:
         fontsize=36:
         fontcolor=white@0.5:
         x=w-tw-20:
         y=20
```

**参数说明**：
- `text`: 水印文字内容
- `fontfile`: 字体文件路径（Windows 需要转义 `\` 为 `/`）
- `fontsize`: 字体大小（像素）
- `fontcolor`: 颜色@透明度
- `x`: X 坐标（支持表达式）
  - `w`: 视频宽度
  - `tw`: 文字宽度
  - `w-tw-20`: 右对齐留 20px 边距
- `y`: Y 坐标（支持表达式）
  - `h`: 视频高度
  - `th`: 文字高度

### 坐标计算

```python
# 右上角
x = "w-tw-margin"  # 视频宽度 - 文字宽度 - 边距
y = "margin"        # 顶部边距

# 左上角
x = "margin"        # 左侧边距
y = "margin"        # 顶部边距

# 右下角
x = "w-tw-margin"   # 视频宽度 - 文字宽度 - 边距
y = "h-th-margin"   # 视频高度 - 文字高度 - 边距

# 左下角
x = "margin"        # 左侧边距
y = "h-th-margin"   # 视频高度 - 文字高度 - 边距
```

## 📊 效果示例

### 不同分辨率下的水印对比

```
1080p 横屏:
┌─────────────────────────────────┐
│              老猿世界观察 (36px) │
│                                  │
│         [主要内容区域]           │
│                                  │
└─────────────────────────────────┘

720p 横屏:
┌───────────────────────────┐
│        老猿世界观察 (24px) │
│                            │
│     [主要内容区域]         │
│                            │
└───────────────────────────┘

1080p 竖屏:
┌─────────────┐
│老猿世界观察  │ (64px)
│              │
│              │
│  [主要内容]  │
│              │
│              │
│              │
└─────────────┘
```

## 🎓 进阶技巧

### 1. 对比色水印
- 深色背景 → 白色水印
- 浅色背景 → 黑色水印
- 适当降低透明度增强可读性

### 2. 品牌水印
- 使用公司/品牌名称
- 固定位置（建立品牌识别）
- 0.5-0.6 透明度（不遮挡内容）

### 3. 时间戳水印
- 添加当前日期/时间
- 左下角或右下角
- 较小透明度（0.4）

---

**更新日期**: 2025-11-17  
**功能版本**: v2.0  
**状态**: ✅ 已完成并测试
